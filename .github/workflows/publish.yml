name: Publish release

on:
  release:
    types: [published]

env:
  DEVELOPER_DIR: /Applications/Xcode_14.3.app/Contents/Developer

jobs:
  release:
    runs-on: macos-13

    steps:

    - uses: actions/checkout@v3
      with:
        ref: ${{ github.event.release.tag_name }}

    - name: Bootstrap
      uses: ./.github/actions/bootstrap

    - name: Publish to Cocoapods
      run: |
        set -eo pipefail
        bundle exec pod lib lint --allow-warnings
        bundle exec pod trunk push --allow-warnings
      env:
        COCOAPODS_TRUNK_TOKEN: ${{ secrets.COCOAPODS_TRUNK_TOKEN }}
